# Working with environment variables (TL;DR)

1. **Copy the template:** `cp .env.example .env` (only needs to happen once per project).
2. **Fill in the values:** edit `.env` so that `PROJECT_NAME`, `HOST_USERNAME`, `HOST_UID`, `HOST_GID`, Git info, `EDITOR_CHOICE`, `CONTAINER_HOSTNAME=${PROJECT_NAME}-${EDITOR_CHOICE}`, `DOCKER_IMAGE_NAME=${PROJECT_NAME}-${EDITOR_CHOICE}`, etc. match your machine. This file is the single source of truth.
3. **Host vars from env:** Ansible host vars read from `.env` via `lookup('env', ...)`. Populate `ANSIBLE_USER`, `ANSIBLE_SSH_PRIVATE_KEY_FILE`, and the `PIHOLE_*` fields here. Set `PIHOLE_COMPOSE_DIR`, `PIHOLE_DATA_DIR`, and `PIHOLE_DNSMASQ_DIR` explicitly. `PIHOLE_UID`/`PIHOLE_GID` are optional; the role will detect the container’s `pihole` UID/GID and use those for ownership fixes if they differ. Use `PIHOLE_NETWORK_MODE=host` to avoid Docker port-forwarding issues. Use `PIHOLE_DNS1`/`PIHOLE_DNS2` for upstream DNS (avoid pointing to Pi-hole itself during bootstrap). `PIHOLE_DNSMASQ_LISTENING` maps to Pi-hole v6 `dns.listeningMode` (LOCAL, SINGLE, BIND, ALL, NONE); when empty the role auto-selects `ALL` for Traefik+bridge and `LOCAL` otherwise. Set `PIHOLE_HEALTHCHECK_ENABLED=true` to enable the admin endpoint check. For Traefik, set `PIHOLE_TRAEFIK_ENABLED=true`, `PIHOLE_TRAEFIK_HOST`, and `PIHOLE_TRAEFIK_NETWORK`, and use `PIHOLE_NETWORK_MODE=bridge` (disable the health check or leave it false). If the Traefik hostname differs per box, override `pihole_traefik_enabled`/`pihole_traefik_host` in each `src/inventory/host_vars/<host>.yml`. Set `PIHOLE_SYSTEMD_AUTOSTART=true` to install a boot-time `docker compose up -d` unit. For replicas, set `PIHOLE_SYNC_ENABLED=true`, point `PIHOLE_SYNC_PRIMARY_URL` at the primary UI, and set `PIHOLE_SYNC_INTERVAL`, `PIHOLE_SYNC_BACKOFF_SECONDS`, `PIHOLE_SYNC_LOCAL_API`, `PIHOLE_SYNC_VERIFY`, and `PIHOLE_SYNC_VERIFY_DELAY`. `PIHOLE_SYNC_PASSWORD` is required and should match the UI/API password. Set `PIHOLE_API_MAX_SESSIONS` to avoid API seat exhaustion during sync/verification. Set `PIHOLE_API_TOKEN` only if you want to override the token read from `/etc/pihole/pihole-FTL.conf` (legacy). The report uses `PIHOLE_REPORT_MODE=cli` by default and falls back to API mode using `PIHOLE_API_PASSWORD` (or `PIHOLE_WEB_PASSWORD` if unset).
   - Daily report settings live in `DAILY_REPORT_*` and are used to send a scheduled email summary.
   - `pihole_local_ipv4` is set per-host in `src/inventory/host_vars` and should match the host IP.
4. **Optional defaults:** if you create `.devcontainer/config/.env` (usually by copying `.devcontainer/config/.env.example`), the loader fills any missing variables from it without overwriting `.env`.
5. **Validate & launch:** always start your session with `./launch.sh`. It loads `.env`, runs `.devcontainer/scripts/validate-env.sh`, and only opens VS Code/Cursor/Antigravity after the check passes. If something is wrong, the script exits with the list of fixes so you don’t waste time booting the devcontainer.
6. **Inside the container:** every helper script sources `.devcontainer/scripts/env-loader.sh`, so anything defined in `.env` automatically shows up in init/post-create hooks and in your shell.
7. **Adding new variables:** document them in `.env.example`, consume them via `env-loader.sh`, and (if they’re required) add a rule to `.devcontainer/scripts/validate-env.sh`. No other script needs to change. For multiple git remotes, set `GIT_SYNC_REMOTES`, `GIT_SYNC_PUSH_REMOTES`, and matching `GIT_REMOTE_URL_<REMOTE>` entries here as well.

Keep `.env` out of version control (already covered by `.gitignore`) so each machine can store its own user-specific values without conflicts.
